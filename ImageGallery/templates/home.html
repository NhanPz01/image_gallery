<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../static/css/home.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=VT323&display=swap"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Document</title>
  </head>

  <body>
    <div class="header">
      <a href="{{ url_for('home') }}">
        <div class="logo">
          <h1 class="logo-text logo-text-color-blue">A</h1>
          <h1 class="logo-text logo-text-color-gold">R</h1>
          <h1 class="logo-text logo-text-color-crimson">T</h1>
          <h1 class="logo-text">GALLERY</h1>
        </div>
      </a>

      <div
        style="
          display: flex;
          flex-direction: column;
          justify-self: center;
          align-items: center;
          color: white;
        "
      >
        <h4 style="font-weight: 100">Nguyễn Ngọc Bảo Nhân</h4>
        <h4 style="font-weight: 100">Nguyễn Văn Bách</h4>
        <h4 style="font-weight: 100">Đặng Ngọc Nam</h4>
      </div>
      <div style="display: flex; align-items: center">
        <div style="color: white; text-align: center; margin-right: 20px">
          {{ user.username }}
        </div>
        <div class="navigation">
          <a href="{{ url_for('post') }}" class="nav-button"
            >Share your picture</a
          >
        </div>
        <div class="navigation">
          <a href="{{ url_for('logout') }}" class="logout-button">Logout</a>
        </div>
      </div>
    </div>

    <div
      style="
        display: flex;
        width: vw;
        justify-content: space-between;
        padding: 10px;
      "
    >
      {% for tag in tags %}
      <div class="tag">{{tag.name}}</div>
      {% endfor %}
    </div>

    <div class="container">
      <div class="picture-gallery">
        {% for data in file_data %}
        <div class="picture">
          <img
            src="{{ url_for('uploaded_file', file_id=data.file.id) }}"
            alt="{{ data.file.filename }}"
            data-tags="{{ data.tags|join(', ') }}"
            data-username="{{ data.username }}"
            data-upload-time="{{ data.upload_time }}"
          />
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- The Modal -->
    <div id="myModal" style="display: none">
      <span class="close">&times;</span>
      <div class="modal-content">
        <img id="modalImage" src="" alt="Image" />
        <div>
          <p id="modalTags">Tags:</p>
          <p id="modalUsername">Username:</p>
          <p id="modalUploadTime">Upload Time:</p>
          <a id="modalDownloadLink" href="">Download</a>
        </div>
      </div>
    </div>

    <script>
      // Get the modal
      var modal = document.getElementById("myModal");

      // Get the image and insert it inside the modal - use its "alt" text as a caption
      var images = document.getElementsByClassName("picture");
      var modalImg = document.getElementById("modalImage");
      var modalUsername = document.getElementById("modalUsername");
      var modalUploadTime = document.getElementById("modalUploadTime");
      var modalTags = document.getElementById("modalTags");
      var modalDownloadLink = document.getElementById("modalDownloadLink");
      for (var i = 0; i < images.length; i++) {
        var img = images[i].getElementsByTagName("img")[0];
        img.onclick = function () {
          modal.style.display = "block";
          modalImg.src = this.src;
          modalUsername.innerHTML = "Username: " + this.dataset.username;
          modalUploadTime.innerHTML = "Upload Time: " + this.dataset.uploadTime;
          modalTags.innerHTML = "Tags: " + this.dataset.tags;
          modalDownloadLink.href = this.src;
          modal.style.display = "flex";
        };
      }

      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      // When the user clicks on <span> (x), close the modal
      span.onclick = function () {
        modal.style.display = "none";
        modalImg.src = "";
        modalUsername.innerHTML = "";
        modalUploadTime.innerHTML = "";
        modalDownloadLink.href = "";
      };

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
          modalImg.src = "";
          modalUsername.innerHTML = "";
          modalUploadTime.innerHTML = "";
          modalDownloadLink.href = "";
        }
      };
      $(document).ready(function () {
        $(".tag").click(function () {
          var tag_name = $(this).text();
          $.get("/tag/" + tag_name, function (data) {
            // Clear the image gallery
            $(".picture-gallery").empty();

            // Add each image to the gallery
            data.forEach(function (image) {
              $(".picture-gallery").append(
                '<div class="picture"><img src="' +
                  image.url +
                  '" alt="' +
                  image.filename +
                  '" data-username="' +
                  image.username +
                  '" data-upload-time="' +
                  image.upload_time +
                  '" /></div>'
              );
            });
          });
        });
      });
    </script>
  </body>
</html>
